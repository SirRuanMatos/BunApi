<p align="center">
    <picture>
      <img src="data:image/svg+xml;base64, PHN2ZyBpZD0iQnVuIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA4MCA3MCI+PHRpdGxlPkJ1biBMb2dvPC90aXRsZT48cGF0aCBpZD0iU2hhZG93IiBkPSJNNzEuMDksMjAuNzRjLS4xNi0uMTctLjMzLS4zNC0uNS0uNXMtLjMzLS4zNC0uNS0uNS0uMzMtLjM0LS41LS41LS4zMy0uMzQtLjUtLjUtLjMzLS4zNC0uNS0uNS0uMzMtLjM0LS41LS41LS4zMy0uMzQtLjUtLjVBMjYuNDYsMjYuNDYsMCwwLDEsNzUuNSwzNS43YzAsMTYuNTctMTYuODIsMzAuMDUtMzcuNSwzMC4wNS0xMS41OCwwLTIxLjk0LTQuMjMtMjguODMtMTAuODZsLjUuNS41LjUuNS41LjUuNS41LjUuNS41LjUuNUMxOS41NSw2NS4zLDMwLjE0LDY5Ljc1LDQyLDY5Ljc1YzIwLjY4LDAsMzcuNS0xMy40OCwzNy41LTMwQzc5LjUsMzIuNjksNzYuNDYsMjYsNzEuMDksMjAuNzRaIi8+PGcgaWQ9IkJvZHkiPjxwYXRoIGlkPSJCYWNrZ3JvdW5kIiBkPSJNNzMsMzUuN2MwLDE1LjIxLTE1LjY3LDI3LjU0LTM1LDI3LjU0UzMsNTAuOTEsMywzNS43QzMsMjYuMjcsOSwxNy45NCwxOC4yMiwxM1MzMy4xOCwzLDM4LDNzOC45NCw0LjEzLDE5Ljc4LDEwQzY3LDE3Ljk0LDczLDI2LjI3LDczLDM1LjdaIiBzdHlsZT0iZmlsbDojZmJmMGRmIi8+PHBhdGggaWQ9IkJvdHRvbV9TaGFkb3ciIGRhdGEtbmFtZT0iQm90dG9tIFNoYWRvdyIgZD0iTTczLDM1LjdhMjEuNjcsMjEuNjcsMCwwLDAtLjgtNS43OGMtMi43MywzMy4zLTQzLjM1LDM0LjktNTkuMzIsMjQuOTRBNDAsNDAsMCwwLDAsMzgsNjMuMjRDNTcuMyw2My4yNCw3Myw1MC44OSw3MywzNS43WiIgc3R5bGU9ImZpbGw6I2Y2ZGVjZSIvPjxwYXRoIGlkPSJMaWdodF9TaGluZSIgZGF0YS1uYW1lPSJMaWdodCBTaGluZSIgZD0iTTI0LjUzLDExLjE3QzI5LDguNDksMzQuOTQsMy40Niw0MC43OCwzLjQ1QTkuMjksOS4yOSwwLDAsMCwzOCwzYy0yLjQyLDAtNSwxLjI1LTguMjUsMy4xMy0xLjEzLjY2LTIuMywxLjM5LTMuNTQsMi4xNS0yLjMzLDEuNDQtNSwzLjA3LTgsNC43QzguNjksMTguMTMsMywyNi42MiwzLDM1LjdjMCwuNCwwLC44LDAsMS4xOUM5LjA2LDE1LjQ4LDIwLjA3LDEzLjg1LDI0LjUzLDExLjE3WiIgc3R5bGU9ImZpbGw6I2ZmZmVmYyIvPjxwYXRoIGlkPSJUb3AiIGQ9Ik0zNS4xMiw1LjUzQTE2LjQxLDE2LjQxLDAsMCwxLDI5LjQ5LDE4Yy0uMjguMjUtLjA2LjczLjMuNTksMy4zNy0xLjMxLDcuOTItNS4yMyw2LTEzLjE0QzM1LjcxLDUsMzUuMTIsNS4xMiwzNS4xMiw1LjUzWm0yLjI3LDBBMTYuMjQsMTYuMjQsMCwwLDEsMzksMTljLS4xMi4zNS4zMS42NS41NS4zNkM0MS43NCwxNi41Niw0My42NSwxMSwzNy45Myw1LDM3LjY0LDQuNzQsMzcuMTksNS4xNCwzNy4zOSw1LjQ5Wm0yLjc2LS4xN0ExNi40MiwxNi40MiwwLDAsMSw0NywxNy4xMmEuMzMuMzMsMCwwLDAsLjY1LjExYy45Mi0zLjQ5LjQtOS40NC03LjE3LTEyLjUzQzQwLjA4LDQuNTQsMzkuODIsNS4wOCw0MC4xNSw1LjMyWk0yMS42OSwxNS43NmExNi45NCwxNi45NCwwLDAsMCwxMC40Ny05Yy4xOC0uMzYuNzUtLjIyLjY2LjE4LTEuNzMsOC03LjUyLDkuNjctMTEuMTIsOS40NUMyMS4zMiwxNi40LDIxLjMzLDE1Ljg3LDIxLjY5LDE1Ljc2WiIgc3R5bGU9ImZpbGw6I2NjYmVhNztmaWxsLXJ1bGU6ZXZlbm9kZCIvPjxwYXRoIGlkPSJPdXRsaW5lIiBkPSJNMzgsNjUuNzVDMTcuMzIsNjUuNzUuNSw1Mi4yNy41LDM1LjdjMC0xMCw2LjE4LTE5LjMzLDE2LjUzLTI0LjkyLDMtMS42LDUuNTctMy4yMSw3Ljg2LTQuNjIsMS4yNi0uNzgsMi40NS0xLjUxLDMuNi0yLjE5QzMyLDEuODksMzUsLjUsMzgsLjVzNS42MiwxLjIsOC45LDMuMTRjMSwuNTcsMiwxLjE5LDMuMDcsMS44NywyLjQ5LDEuNTQsNS4zLDMuMjgsOSw1LjI3QzY5LjMyLDE2LjM3LDc1LjUsMjUuNjksNzUuNSwzNS43LDc1LjUsNTIuMjcsNTguNjgsNjUuNzUsMzgsNjUuNzVaTTM4LDNjLTIuNDIsMC01LDEuMjUtOC4yNSwzLjEzLTEuMTMuNjYtMi4zLDEuMzktMy41NCwyLjE1LTIuMzMsMS40NC01LDMuMDctOCw0LjdDOC42OSwxOC4xMywzLDI2LjYyLDMsMzUuNywzLDUwLjg5LDE4LjcsNjMuMjUsMzgsNjMuMjVTNzMsNTAuODksNzMsMzUuN0M3MywyNi42Miw2Ny4zMSwxOC4xMyw1Ny43OCwxMyw1NCwxMSw1MS4wNSw5LjEyLDQ4LjY2LDcuNjRjLTEuMDktLjY3LTIuMDktMS4yOS0zLTEuODRDNDIuNjMsNCw0MC40MiwzLDM4LDNaIi8+PC9nPjxnIGlkPSJNb3V0aCI+PGcgaWQ9IkJhY2tncm91bmQtMiIgZGF0YS1uYW1lPSJCYWNrZ3JvdW5kIj48cGF0aCBkPSJNNDUuMDUsNDNhOC45Myw4LjkzLDAsMCwxLTIuOTIsNC43MSw2LjgxLDYuODEsMCwwLDEtNCwxLjg4QTYuODQsNi44NCwwLDAsMSwzNCw0Ny43MSw4LjkzLDguOTMsMCwwLDEsMzEuMTIsNDNhLjcyLjcyLDAsMCwxLC44LS44MUg0NC4yNkEuNzIuNzIsMCwwLDEsNDUuMDUsNDNaIiBzdHlsZT0iZmlsbDojYjcxNDIyIi8+PC9nPjxnIGlkPSJUb25ndWUiPjxwYXRoIGlkPSJCYWNrZ3JvdW5kLTMiIGRhdGEtbmFtZT0iQmFja2dyb3VuZCIgZD0iTTM0LDQ3Ljc5YTYuOTEsNi45MSwwLDAsMCw0LjEyLDEuOSw2LjkxLDYuOTEsMCwwLDAsNC4xMS0xLjksMTAuNjMsMTAuNjMsMCwwLDAsMS0xLjA3LDYuODMsNi44MywwLDAsMC00LjktMi4zMSw2LjE1LDYuMTUsMCwwLDAtNSwyLjc4QzMzLjU2LDQ3LjQsMzMuNzYsNDcuNiwzNCw0Ny43OVoiIHN0eWxlPSJmaWxsOiNmZjYxNjQiLz48cGF0aCBpZD0iT3V0bGluZS0yIiBkYXRhLW5hbWU9Ik91dGxpbmUiIGQ9Ik0zNC4xNiw0N2E1LjM2LDUuMzYsMCwwLDEsNC4xOS0yLjA4LDYsNiwwLDAsMSw0LDEuNjljLjIzLS4yNS40NS0uNTEuNjYtLjc3YTcsNywwLDAsMC00LjcxLTEuOTMsNi4zNiw2LjM2LDAsMCwwLTQuODksMi4zNkE5LjUzLDkuNTMsMCwwLDAsMzQuMTYsNDdaIi8+PC9nPjxwYXRoIGlkPSJPdXRsaW5lLTMiIGRhdGEtbmFtZT0iT3V0bGluZSIgZD0iTTM4LjA5LDUwLjE5YTcuNDIsNy40MiwwLDAsMS00LjQ1LTIsOS41Miw5LjUyLDAsMCwxLTMuMTEtNS4wNSwxLjIsMS4yLDAsMCwxLC4yNi0xLDEuNDEsMS40MSwwLDAsMSwxLjEzLS41MUg0NC4yNmExLjQ0LDEuNDQsMCwwLDEsMS4xMy41MSwxLjE5LDEuMTksMCwwLDEsLjI1LDFoMGE5LjUyLDkuNTIsMCwwLDEtMy4xMSw1LjA1QTcuNDIsNy40MiwwLDAsMSwzOC4wOSw1MC4xOVptLTYuMTctNy40Yy0uMTYsMC0uMi4wNy0uMjEuMDlhOC4yOSw4LjI5LDAsMCwwLDIuNzMsNC4zN0E2LjIzLDYuMjMsMCwwLDAsMzguMDksNDlhNi4yOCw2LjI4LDAsMCwwLDMuNjUtMS43Myw4LjMsOC4zLDAsMCwwLDIuNzItNC4zNy4yMS4yMSwwLDAsMC0uMi0uMDlaIi8+PC9nPjxnIGlkPSJGYWNlIj48ZWxsaXBzZSBpZD0iUmlnaHRfQmx1c2giIGRhdGEtbmFtZT0iUmlnaHQgQmx1c2giIGN4PSI1My4yMiIgY3k9IjQwLjE4IiByeD0iNS44NSIgcnk9IjMuNDQiIHN0eWxlPSJmaWxsOiNmZWJiZDAiLz48ZWxsaXBzZSBpZD0iTGVmdF9CbHVjaCIgZGF0YS1uYW1lPSJMZWZ0IEJsdWNoIiBjeD0iMjIuOTUiIGN5PSI0MC4xOCIgcng9IjUuODUiIHJ5PSIzLjQ0IiBzdHlsZT0iZmlsbDojZmViYmQwIi8+PHBhdGggaWQ9IkV5ZXMiIGQ9Ik0yNS43LDM4LjhhNS41MSw1LjUxLDAsMSwwLTUuNS01LjUxQTUuNTEsNS41MSwwLDAsMCwyNS43LDM4LjhabTI0Ljc3LDBBNS41MSw1LjUxLDAsMSwwLDQ1LDMzLjI5LDUuNSw1LjUsMCwwLDAsNTAuNDcsMzguOFoiIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZCIvPjxwYXRoIGlkPSJJcmlzIiBkPSJNMjQsMzMuNjRhMi4wNywyLjA3LDAsMSwwLTIuMDYtMi4wN0EyLjA3LDIuMDcsMCwwLDAsMjQsMzMuNjRabTI0Ljc3LDBhMi4wNywyLjA3LDAsMSwwLTIuMDYtMi4wN0EyLjA3LDIuMDcsMCwwLDAsNDguNzUsMzMuNjRaIiBzdHlsZT0iZmlsbDojZmZmO2ZpbGwtcnVsZTpldmVub2RkIi8+PC9nPjwvc3ZnPg==" width="64">
    </picture>
  <br />
</p>
<div align="center">
  <h1>
    Bun API – Order Management System
  </h1>
  <br />
    <img alt="Bun" src="https://img.shields.io/badge/Bun-1.3.1-grey?logo=bun" />
    <img alt="Typescript" src="https://img.shields.io/badge/Typescript-5.9.3-blue?style=flat&logo=typescript" />
    <img alt="Elysia"  src="https://img.shields.io/badge/Elysia-1.4.13-pink?style=flat" />
    <img alt="Drizzle" src="https://img.shields.io/badge/Drizzle-0.31.6-green?style=flat&logo=drizzle" />
    <img alt="PostgreSQL" src="https://img.shields.io/badge/PostgreSQL-3.4.7-blue?style=flat&logo=postgresql" />
  <br />
  <br />
  <p>
    <strong>
      Order Management API built with Bun + Elysia + Drizzle ORM + PostgreSQL, Magic Link authentication (Nodemailer + JWT) and ready-to-run Docker Compose setup.
    </strong>
  </p>
</div>

# Bun API

API built to power an **order management dashboard**, using the high-performance **Bun runtime** and the **Elysia** HTTP framework.
Data persistence is handled by **PostgreSQL** through **Drizzle ORM**, providing type-safe queries and reliable migrations.
Authentication is implemented using a Magic Link flow, where login links are sent via **Nodemailer**, and sessions are secured using **JWT (JSON Web Token)**.

The entire database environment is orchestrated through **Docker Compose**, ensuring an easy setup, portability, and a smooth development workflow.

## Requirements

- Bun 1.3.1
- Docker

## Installation

Install my project

```bash
    git clone https://github.com/SirRuanMatos/BunApi
    cd BunApi
    bun install
```

## Environment Variables

To run this project, you will need to add the following environment variables to your .env file

`DATABASE_URL` - Connection string for your PostgreSQL database (used by Drizzle ORM). Example: postgres://user:password@localhost:5432/database

`AUTH_REDIRECT_URL` - URL used to redirect the user after the Magic Link authentication (your frontend callback URL).

`API_BASE_URL` - Base URL of this API (used to generate Magic Link authentication URLs).

`JWT_SECRET_KEY` - Secret key used to sign and validate JWT authentication tokens.

```bash
DATABASE_URL="postgresql://docker:docker@localhost:5432/bunApishop"
AUTH_REDIRECT_URL="http://localhost:5173"
API_BASE_URL="http://localhost:3333"
JWT_SECRET_KEY="my-super-secret-key"
```

## Compose yout DB (Postgres)

To start the PostgreSQL database using Docker Compose, run the command below at the project root:

```bash
docker compose up -d
```

This will:

- Create and start the PostgreSQL container in the background (-d)

- Expose the database on the port defined in docker-compose.yml

- Allow the API to connect using the DATABASE_URL value from your .env file

- After the container starts, the API will be able to connect to the database normally using Drizzle ORM.

## Run Drizzle Migrations

After starting the PostgreSQL database and configuring your .env file, run the Drizzle migrations to create the tables in your database:

```bash
bun generate
bun migrate
```

What these commands do:

- bun generate → generates migration files based on your Drizzle schema.
- bun migrate → applies the generated migrations to your database.
  `✅ Only run these commands after the database is running via docker compose up -d.`

## Populate your database

To populate your database with initial (random) test data, run the following command:

```bash
bun seed
```

This command inserts mock data into the tables, making it easier to test the application without manually creating records.

## Start the Application (Development)

To start the application in development mode, run:

```bash
bun dev
```

This will:

- Start the server with hot reload
- Watch your files for changes
  `Ensure your database is running before starting the application.`

## Start the Application (Production)

To build and run the application in production mode, use:

```bash
bun build
bun start
```

What these commands do:

- bun build → compiles and optimizes the project for production
- bun start → runs the compiled application
  `In production mode, Bun does not reload automatically — it's optimized for performance and stability.`

## Endpoints

| Method | Path          | Description                                                      |
| ------ | ------------- | ---------------------------------------------------------------- |
| POST   | /restaurants  | Creates a new restaurant and automatically registers its manager |
| POST   | /authenticate | Authenticate user sending magical link to user email passed      |

### /restaurants

##### Body

| Parameter        | Type     | Required | Description                                                                                                    |
| :--------------- | :------- | :------- | :------------------------------------------------------------------------------------------------------------- |
| `restaurantName` | `string` | ✅ Yes   | Name of the restaurant to be created.                                                                          |
| `managerName`    | `string` | ✅ Yes   | Full name of the restaurant manager (user that will receive the Magic Link).                                   |
| `email`          | `string` | ✅ Yes   | Email used to create the manager account and receive the Magic Link for authentication. Must be a valid email. |
| `phone`          | `string` | ❌ No    | Contact phone number of the manager. Can include only numbers or formatting.                                   |

```bash
curl --location 'http://localhost:3333/restaurants' \
--header 'Content-Type: application/json' \
--data-raw '{
	"restaurantName": "Ruan Pizza",
	"managerName": "Ruan Ferreira",
	"email": "ruan@teste.com",
	"phone": "5499999999"
}'
```

### /authenticate

This endpoint starts the Magic Link authentication flow.
It sends a login link to the provided email, allowing the user to authenticate without using a password.

##### Body

| Parameter | Type     | Required | Description                                                                                            |
| :-------- | :------- | :------- | :----------------------------------------------------------------------------------------------------- |
| `email`   | `string` | ✅ Yes   | Email of the user who wants to authenticate and receive the Magic Link. Must be a valid email address. |

```bash
curl --location 'http://localhost:3333/authenticate' \
--header 'Content-Type: application/json' \
--data-raw '{
	"email": "admin@admin.com"
}'
```

### /auth-links/authenticate

This endpoint completes the Magic Link authentication flow.

It validates the authentication code generated during the request to /authenticate.
If the code is valid, a JWT token is created and the user is redirected to the provided redirectUrl with the token attached.

##### Query

| Parameter     | Type     | Required | Description                                                                                                                            |
| :------------ | :------- | :------- | :------------------------------------------------------------------------------------------------------------------------------------- |
| `code`        | `string` | ✅ Yes   | One-time authorization code generated during the Magic Link process. Used to validate the user and create a session.                   |
| `redirectUrl` | `string` | ✅ Yes   | URL where the user will be redirected after authentication (usually your frontend application). The JWT token is appended to this URL. |

```bash
curl --location 'http://localhost:3333/auth-links/authenticate?code=ugl2jb8phyg2gtszi3zasg3b&redirectUrl=http%3A%2F%2Flocalhost%3A5173' \
```

### /sign-out

This endpoint invalidates the current session and removes the authentication cookie, effectively signing the user out.

##### Header

| Parameter              | Type     | Required | Description                                                         |
| :--------------------- | :------- | :------- | :------------------------------------------------------------------ |
| `Cookie: auth=<token>` | `string` | ✅ Yes   | Cookie that contains the JWT used to authenticate the user session. |

```bash
curl --location --request POST 'http://localhost:3333/sign-out' \
--header 'Cookie: auth=[JWT]'
```

### /me

This endpoint returns the authenticated user's profile information.

##### Header

| Parameter              | Type     | Required | Description                                                         |
| :--------------------- | :------- | :------- | :------------------------------------------------------------------ |
| `Cookie: auth=<token>` | `string` | ✅ Yes   | Cookie that contains the JWT used to authenticate the user session. |

```bash
curl --location --request POST 'http://localhost:3333/me' \
--header 'Cookie: auth=[JWT]'
```

### /managed-restaurant

This endpoint returns the authenticated user's restaurant managed information.

##### Header

| Parameter              | Type     | Required | Description                                                         |
| :--------------------- | :------- | :------- | :------------------------------------------------------------------ |
| `Cookie: auth=<token>` | `string` | ✅ Yes   | Cookie that contains the JWT used to authenticate the user session. |

```bash
curl --location --request POST 'http://localhost:3333/managed-restaurant' \
--header 'Cookie: auth=[JWT]'
```

### /orders/:id

This endpoint returns information about a specific order, only if the authenticated user has access to it.

##### Header

| Parameter              | Type     | Required | Description                                                         |
| :--------------------- | :------- | :------- | :------------------------------------------------------------------ |
| `Cookie: auth=<token>` | `string` | ✅ Yes   | Cookie that contains the JWT used to authenticate the user session. |

##### Path

| Parameter | Type     | Required | Description                      |
| :-------- | :------- | :------- | :------------------------------- |
| `id`      | `string` | ✅ Yes   | ID of the order to be retrieved. |

```bash
curl --location 'http://localhost:3333/orders/<order-id>' \
--header 'Cookie: auth=[JWT]'
```

### /orders/:id/:status

This endpoint updates the status of an existing order.

Valid status values are:
 - approve
 - dispatch
 - deliver
 - cancel

Only authenticated managers of the restaurant that owns the order can update the status.

##### Header

| Parameter              | Type     | Required | Description                                                         |
| :--------------------- | :------- | :------- | :------------------------------------------------------------------ |
| `Cookie: auth=<token>` | `string` | ✅ Yes   | Cookie that contains the JWT used to authenticate the user session. |

##### Path

| Parameter | Type     | Required | Description                      |
| :-------- | :------- | :------- | :------------------------------- |
| `id`      | `string` | ✅ Yes   | ID of the order that will be updated. |
| `status`      | `string` | ✅ Yes   | New status for the order. Must be one of the valid statuses listed above. |

```bash
curl --location --request PATCH  'http://localhost:3333/orders/<order-id>/<status>' \
--header 'Cookie: auth=[JWT]'
```
